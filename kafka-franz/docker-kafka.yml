services:

####################
# Kafka Controllers
####################
  kafka-controller-1:
    extends:
      file: docker-kafka-base.yml
      service: kafka-controller
    container_name: kafka-controller-1
    environment:
      KAFKA_NODE_ID: 1

  kafka-controller-2:
    extends:
      file: docker-kafka-base.yml
      service: kafka-controller
    container_name: kafka-controller-2
    environment:
      KAFKA_NODE_ID: 2

  kafka-controller-3:
    extends:
      file: docker-kafka-base.yml
      service: kafka-controller
    container_name: kafka-controller-3
    environment:
      KAFKA_NODE_ID: 3

####################
# Kafka Brokers
####################
  kafka-broker-1:
    extends:
      file: docker-kafka-base.yml
      service: kafka-broker
    container_name: kafka-broker-1
    ports:
      - 29092:9092
    environment:
      KAFKA_NODE_ID: 4
      KAFKA_ADVERTISED_LISTENERS: 'PLAINTEXT://kafka-broker-1:19092,PLAINTEXT_HOST://localhost:29092'

  kafka-broker-2:
    extends:
      file: docker-kafka-base.yml
      service: kafka-broker
    container_name: kafka-broker-2
    ports:
      - 39092:9092
    environment:
      KAFKA_NODE_ID: 5
      KAFKA_ADVERTISED_LISTENERS: 'PLAINTEXT://kafka-broker-2:19092,PLAINTEXT_HOST://localhost:39092'

  kafka-broker-3:
    extends:
      file: docker-kafka-base.yml
      service: kafka-broker
    container_name: kafka-broker-3
    ports:
      - 49092:9092
    environment:
      KAFKA_NODE_ID: 6
      KAFKA_ADVERTISED_LISTENERS: 'PLAINTEXT://kafka-broker-3:19092,PLAINTEXT_HOST://localhost:49092'

  ####################
  # Kafka Creator
  ####################
  kafka-topics-creator:
    container_name: kafka-topics-creator
    extends:
      file: docker-kafka-base.yml
      service: kafka-commands
      command: /opt/kafka/bin/kafka-topics.sh --bootstrap-server kafka-broker-1:19092,kafka-broker-2:19092,kafka-broker-3:19092 --create --if-not-exists --topic test-topic

# Network
networks:
  kafka-network:
    driver: bridge
